<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>mmrobot-server: demo_xenomai.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>demo_xenomai.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/mman.h&gt;</code><br/>
<code>#include &lt;termios.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;native/task.h&gt;</code><br/>
<code>#include &lt;native/timer.h&gt;</code><br/>
<code>#include &quot;../gqueue.h&quot;</code><br/>
<code>#include &quot;../gmatlabdatafile.h&quot;</code><br/>
<code>#include &quot;../gdatalogger.h&quot;</code><br/>

<p><a href="demo__xenomai_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a502e8ff04fbdaca75759b6aa95a80260">TASK1_PERIOD_IN_NANO</a>&nbsp;&nbsp;&nbsp;1000000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a7ca9dde848cb8a9965f2f05c0e00fd1d">TASK2_PERIOD_IN_NANO</a>&nbsp;&nbsp;&nbsp;1000000</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#af2dc378d0481adcc49b61efb98493a9b">catch_signal</a> (int sig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#af5978fab9fa6dd4ced1c3a8ab1251f7b">getch</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a97e9b1fe8d4c010474637a654aad6566">kbhit</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#afcb7264585f095779de891787c516efc">periodicThread_handler1</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a8597333258522dddfc564b5d86ef18fa">periodicThread_handler2</a> (void *arg)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structGDATALOGGER.html">GDATALOGGER</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a3437d43ee84dba8231980614a749bb3a">MatA</a> [3][1]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="demo__xenomai_8c.html#a778870de29c0389f060a5430a7a4f98a">MatB</a> [4][2]</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a502e8ff04fbdaca75759b6aa95a80260"></a><!-- doxytag: member="demo_xenomai.c::TASK1_PERIOD_IN_NANO" ref="a502e8ff04fbdaca75759b6aa95a80260" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TASK1_PERIOD_IN_NANO&nbsp;&nbsp;&nbsp;1000000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00017">17</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ca9dde848cb8a9965f2f05c0e00fd1d"></a><!-- doxytag: member="demo_xenomai.c::TASK2_PERIOD_IN_NANO" ref="a7ca9dde848cb8a9965f2f05c0e00fd1d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TASK2_PERIOD_IN_NANO&nbsp;&nbsp;&nbsp;1000000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00018">18</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="af2dc378d0481adcc49b61efb98493a9b"></a><!-- doxytag: member="demo_xenomai.c::catch_signal" ref="af2dc378d0481adcc49b61efb98493a9b" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void catch_signal </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sig</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00119">119</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00120"></a>00120 {
<a name="l00121"></a>00121 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af5978fab9fa6dd4ced1c3a8ab1251f7b"></a><!-- doxytag: member="demo_xenomai.c::getch" ref="af5978fab9fa6dd4ced1c3a8ab1251f7b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getch </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00239">239</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00240"></a>00240 {
<a name="l00241"></a>00241         <span class="keyword">struct </span>termios oldt,
<a name="l00242"></a>00242         newt;
<a name="l00243"></a>00243         <span class="keywordtype">int</span> ch;
<a name="l00244"></a>00244         tcgetattr( STDIN_FILENO, &amp;oldt );
<a name="l00245"></a>00245         newt = oldt;
<a name="l00246"></a>00246         newt.c_lflag &amp;= ~( ICANON | ECHO );
<a name="l00247"></a>00247         tcsetattr( STDIN_FILENO, TCSANOW, &amp;newt );
<a name="l00248"></a>00248         ch = getchar();
<a name="l00249"></a>00249         tcsetattr( STDIN_FILENO, TCSANOW, &amp;oldt );
<a name="l00250"></a>00250         <span class="keywordflow">return</span> ch;
<a name="l00251"></a>00251 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a97e9b1fe8d4c010474637a654aad6566"></a><!-- doxytag: member="demo_xenomai.c::kbhit" ref="a97e9b1fe8d4c010474637a654aad6566" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kbhit </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00212">212</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00213"></a>00213 {
<a name="l00214"></a>00214         <span class="keyword">struct </span>termios oldt, newt;
<a name="l00215"></a>00215         <span class="keywordtype">int</span> ch;
<a name="l00216"></a>00216         <span class="keywordtype">int</span> oldf;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         tcgetattr(STDIN_FILENO, &amp;oldt);
<a name="l00219"></a>00219         newt = oldt;
<a name="l00220"></a>00220         newt.c_lflag &amp;= ~(ICANON | ECHO);
<a name="l00221"></a>00221         tcsetattr(STDIN_FILENO, TCSANOW, &amp;newt);
<a name="l00222"></a>00222         oldf = fcntl(STDIN_FILENO, F_GETFL, 0);
<a name="l00223"></a>00223         fcntl(STDIN_FILENO, F_SETFL, oldf | O_NONBLOCK);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         ch = getchar();
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         tcsetattr(STDIN_FILENO, TCSANOW, &amp;oldt);
<a name="l00228"></a>00228         fcntl(STDIN_FILENO, F_SETFL, oldf);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="keywordflow">if</span>(ch != EOF)
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232         ungetc(ch, stdin);
<a name="l00233"></a>00233         <span class="keywordflow">return</span> 1;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <span class="keywordflow">return</span> 0;
<a name="l00237"></a>00237 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="demo_xenomai.c::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00123">123</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00124"></a>00124 {
<a name="l00125"></a>00125         RT_TASK task1;
<a name="l00126"></a>00126         RT_TASK task2;
<a name="l00127"></a>00127         <span class="keywordtype">int</span> status,n;
<a name="l00128"></a>00128         <span class="keywordtype">double</span> t0,<a class="code" href="demo__pthread_8c.html#a4e5edfd50d3b15477cb4a7677022faec">tempo</a>;
<a name="l00129"></a>00129                 
<a name="l00130"></a>00130         signal(SIGTERM, <a class="code" href="demo__xenomai_8c.html#af2dc378d0481adcc49b61efb98493a9b">catch_signal</a>);
<a name="l00131"></a>00131         signal(SIGINT, <a class="code" href="demo__xenomai_8c.html#af2dc378d0481adcc49b61efb98493a9b">catch_signal</a>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="comment">/* Avoids memory swapping for this program */</span>
<a name="l00134"></a>00134         mlockall(MCL_CURRENT|MCL_FUTURE);
<a name="l00135"></a>00135         
<a name="l00136"></a>00136         <span class="comment">// Data logger:</span>
<a name="l00137"></a>00137         <span class="keywordflow">if</span>(!<a class="code" href="gdatalogger_8c.html#ab5eeb22d60836d57bae0dde821337045">gDataLogger_Init</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;matlabdatafiles/gmatlabdatafile.mat&quot;</span>,NULL)){
<a name="l00138"></a>00138                 printf(<span class="stringliteral">&quot;\nErro em gDataLogger_Init\n\n&quot;</span>);
<a name="l00139"></a>00139                 <span class="keywordflow">return</span> 1;
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;t1&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,1,1,1000);
<a name="l00143"></a>00143         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;t2&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,1,1,1000);
<a name="l00144"></a>00144         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;T1&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,1,1,1000);
<a name="l00145"></a>00145         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;T2&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,1,1,1000);
<a name="l00146"></a>00146         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;y1&quot;</span>,<span class="stringliteral">&quot;m&quot;</span>,1,1,1000);
<a name="l00147"></a>00147         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;y2&quot;</span>,<span class="stringliteral">&quot;m&quot;</span>,1,1,1000);
<a name="l00148"></a>00148         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;Tsleep1&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,1,1,1000);
<a name="l00149"></a>00149         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;Tsleep2&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,1,1,1000);
<a name="l00150"></a>00150         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;MatA&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>,3,1,1000);
<a name="l00151"></a>00151         <a class="code" href="gdatalogger_8c.html#a3f8f2b3c3f5edc72c3a1887965a544c1">gDataLogger_DeclareVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;MatB&quot;</span>,<span class="stringliteral">&quot;m&quot;</span>,4,2,1000);  
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="comment">// Tarefas</span>
<a name="l00154"></a>00154         status = rt_task_create(&amp;task1, <span class="stringliteral">&quot;task1&quot;</span>, 0, 99, 0);
<a name="l00155"></a>00155         <span class="keywordflow">if</span> (status != 0) {
<a name="l00156"></a>00156                 perror(<span class="stringliteral">&quot;Criacao do thread 1 falhou.\n&quot;</span>);
<a name="l00157"></a>00157                 <span class="keywordflow">return</span> 1;
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159         status = rt_task_start(&amp;task1, &amp;<a class="code" href="demo__xenomai_8c.html#afcb7264585f095779de891787c516efc">periodicThread_handler1</a>, NULL);
<a name="l00160"></a>00160         <span class="keywordflow">if</span> (status != 0) {
<a name="l00161"></a>00161                 perror(<span class="stringliteral">&quot;Inicializacao do thread 1 falhou.\n&quot;</span>);
<a name="l00162"></a>00162                 <span class="keywordflow">return</span> 1;
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164         rt_task_slice(&amp;task1,100000);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         status = rt_task_create(&amp;task2, <span class="stringliteral">&quot;task2&quot;</span>, 0, 99, 0);
<a name="l00167"></a>00167         <span class="keywordflow">if</span> (status != 0) {
<a name="l00168"></a>00168                 perror(<span class="stringliteral">&quot;Criacao do thread 2 falhou.\n&quot;</span>);
<a name="l00169"></a>00169                 <span class="keywordflow">return</span> 1;
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171         status = rt_task_start(&amp;task2, &amp;<a class="code" href="demo__xenomai_8c.html#a8597333258522dddfc564b5d86ef18fa">periodicThread_handler2</a>, NULL);
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (status != 0) {
<a name="l00173"></a>00173                 perror(<span class="stringliteral">&quot;Inicializacao do thread 2 falhou.\n&quot;</span>);
<a name="l00174"></a>00174                 <span class="keywordflow">return</span> 1;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176         rt_task_slice(&amp;task2,100000);
<a name="l00177"></a>00177         
<a name="l00178"></a>00178         t0 = ((double)(rt_timer_read()))/1000000.0;
<a name="l00179"></a>00179         n = 0;
<a name="l00180"></a>00180         <span class="keywordflow">while</span>(!<a class="code" href="keyboard_8c.html#a97e9b1fe8d4c010474637a654aad6566">kbhit</a>()){
<a name="l00181"></a>00181                 usleep(20000);  
<a name="l00182"></a>00182                 <a class="code" href="gdatalogger_8c.html#afa42a993493cf98d32da11e4279816f7">gDataLogger_IPCUpdate</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>); <span class="comment">// gerencia IPC</span>
<a name="l00183"></a>00183                 <span class="keywordflow">if</span>(++n&gt;10){
<a name="l00184"></a>00184                         <a class="code" href="gdatalogger_8c.html#a05dc8ce832b941280d7de26057992640">gDataLogger_MatfileUpdate</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>); <span class="comment">// esvazia os buffers no arquivo de log</span>
<a name="l00185"></a>00185                         tempo = ((double)(rt_timer_read()))/1000000.0 - t0;
<a name="l00186"></a>00186                         printf(<span class="stringliteral">&quot;\n [%i] Atualizado arquivo Matlab em t = %f s&quot;</span>,n,tempo);
<a name="l00187"></a>00187                         n = 0;
<a name="l00188"></a>00188                 }
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         quittask = 1;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         perror(<span class="stringliteral">&quot;\nEncerrando thread 1...&quot;</span>);
<a name="l00194"></a>00194         rt_task_join(&amp;task1); 
<a name="l00195"></a>00195         perror(<span class="stringliteral">&quot; ok\n&quot;</span>);
<a name="l00196"></a>00196         perror(<span class="stringliteral">&quot;\nEncerrando thread 2...&quot;</span>);
<a name="l00197"></a>00197         rt_task_join(&amp;task2); 
<a name="l00198"></a>00198         perror(<span class="stringliteral">&quot; ok\n&quot;</span>);
<a name="l00199"></a>00199         
<a name="l00200"></a>00200         rt_task_delete(&amp;task1);
<a name="l00201"></a>00201         rt_task_delete(&amp;task2);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <span class="comment">// Encerramento do data logger:</span>
<a name="l00204"></a>00204         <a class="code" href="gdatalogger_8c.html#a0ac95f84c6ee484c4ad0351530f1c468">gDataLogger_Close</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>);
<a name="l00205"></a>00205         
<a name="l00206"></a>00206         <span class="keywordflow">return</span> 0;
<a name="l00207"></a>00207 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afcb7264585f095779de891787c516efc"></a><!-- doxytag: member="demo_xenomai.c::periodicThread_handler1" ref="afcb7264585f095779de891787c516efc" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void periodicThread_handler1 </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00029">29</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00030"></a>00030 {
<a name="l00031"></a>00031         <span class="keywordtype">double</span> t0, tprevious, <a class="code" href="demo__pthread_8c.html#a4e5edfd50d3b15477cb4a7677022faec">tempo</a>, tic, toc;
<a name="l00032"></a>00032         <span class="keywordtype">double</span> Tsleep, T, y;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         printf(<span class="stringliteral">&quot;\n**** Tarefa 1.&quot;</span>);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         rt_task_set_periodic(NULL, TM_NOW, <a class="code" href="demo__xenomai_8c.html#a502e8ff04fbdaca75759b6aa95a80260">TASK1_PERIOD_IN_NANO</a>);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038         t0 = ((double)(rt_timer_read()))/1e9;
<a name="l00039"></a>00039         tempo = 0.0;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         <span class="keywordflow">while</span>(!quittask)
<a name="l00042"></a>00042         {       
<a name="l00043"></a>00043                 rt_task_wait_period(NULL);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045                 <span class="comment">// Calculo das variaveis</span>
<a name="l00046"></a>00046                 tprevious = tempo;
<a name="l00047"></a>00047                 tempo = ((double)(rt_timer_read()))/1e9 - t0;
<a name="l00048"></a>00048                 T = tempo - tprevious;
<a name="l00049"></a>00049                 y = sin(2*3.1415926*tempo);
<a name="l00050"></a>00050                 <a class="code" href="demo__pthread_8c.html#a3437d43ee84dba8231980614a749bb3a">MatA</a>[0][0] = y;
<a name="l00051"></a>00051                 <a class="code" href="demo__pthread_8c.html#a3437d43ee84dba8231980614a749bb3a">MatA</a>[1][0] = 2.0*y;
<a name="l00052"></a>00052                 <a class="code" href="demo__pthread_8c.html#a3437d43ee84dba8231980614a749bb3a">MatA</a>[2][0] = -y;
<a name="l00053"></a>00053         
<a name="l00054"></a>00054                 <span class="comment">// usleep</span>
<a name="l00055"></a>00055                 tic = ((double)(rt_timer_read()))/1e9;
<a name="l00056"></a>00056                 rt_task_sleep(10000000);
<a name="l00057"></a>00057                 toc = ((double)(rt_timer_read()))/1e9;
<a name="l00058"></a>00058                 Tsleep = toc-tic;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060                 <span class="comment">// Inserir na fila</span>
<a name="l00061"></a>00061                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;Tsleep1&quot;</span>,&amp;Tsleep);
<a name="l00062"></a>00062                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;t1&quot;</span>,&amp;tempo);
<a name="l00063"></a>00063                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;T1&quot;</span>,&amp;T);
<a name="l00064"></a>00064                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;y1&quot;</span>,&amp;y);
<a name="l00065"></a>00065                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;MatA&quot;</span>,&amp;<a class="code" href="demo__pthread_8c.html#a3437d43ee84dba8231980614a749bb3a">MatA</a>[0][0]);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         printf(<span class="stringliteral">&quot;\nEncerrando a Tarefa 1.&quot;</span>);
<a name="l00070"></a>00070 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8597333258522dddfc564b5d86ef18fa"></a><!-- doxytag: member="demo_xenomai.c::periodicThread_handler2" ref="a8597333258522dddfc564b5d86ef18fa" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void periodicThread_handler2 </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00072">72</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00073"></a>00073 {
<a name="l00074"></a>00074         <span class="keywordtype">double</span> t0, tprevious, <a class="code" href="demo__pthread_8c.html#a4e5edfd50d3b15477cb4a7677022faec">tempo</a>, tic, toc;
<a name="l00075"></a>00075         <span class="keywordtype">double</span> Tsleep, T, y;
<a name="l00076"></a>00076         <span class="keywordtype">int</span> i,j;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         printf(<span class="stringliteral">&quot;\n**** Tarefa 2.&quot;</span>);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         rt_task_set_periodic(NULL, TM_NOW, <a class="code" href="demo__xenomai_8c.html#a7ca9dde848cb8a9965f2f05c0e00fd1d">TASK2_PERIOD_IN_NANO</a>);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         t0 = ((double)(rt_timer_read()))/1e9;
<a name="l00083"></a>00083         tempo = 0.0;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="keywordflow">while</span>(!quittask)
<a name="l00086"></a>00086         {       
<a name="l00087"></a>00087                 rt_task_wait_period(NULL);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089                 <span class="comment">// Calculo das variaveis</span>
<a name="l00090"></a>00090                 tprevious = tempo;
<a name="l00091"></a>00091                 tempo = ((double)(rt_timer_read()))/1e9 - t0;
<a name="l00092"></a>00092                 T = tempo - tprevious;
<a name="l00093"></a>00093                 y = sin(2*3.1415926*tempo);
<a name="l00094"></a>00094         
<a name="l00095"></a>00095                 <span class="keywordflow">for</span> (i=0;i&lt;4;++i){
<a name="l00096"></a>00096                         <span class="keywordflow">for</span> (j=0;j&lt;2;++j){
<a name="l00097"></a>00097                                 <a class="code" href="demo__pthread_8c.html#a778870de29c0389f060a5430a7a4f98a">MatB</a>[i][j] = i*j;
<a name="l00098"></a>00098                         }
<a name="l00099"></a>00099                 }
<a name="l00100"></a>00100                 <span class="comment">//printf(&quot;\n tempo  = %f, y = %f&quot;,tempo,y);</span>
<a name="l00101"></a>00101         
<a name="l00102"></a>00102                 <span class="comment">// usleep</span>
<a name="l00103"></a>00103                 tic = ((double)(rt_timer_read()))/1e9;
<a name="l00104"></a>00104                 rt_task_sleep(10000);
<a name="l00105"></a>00105                 toc = ((double)(rt_timer_read()))/1e9;
<a name="l00106"></a>00106                 Tsleep = toc-tic;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108                 <span class="comment">// Inserir na fila</span>
<a name="l00109"></a>00109                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;Tsleep2&quot;</span>,&amp;Tsleep);
<a name="l00110"></a>00110                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;t2&quot;</span>,&amp;tempo);
<a name="l00111"></a>00111                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;T2&quot;</span>,&amp;T);
<a name="l00112"></a>00112                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;y2&quot;</span>,&amp;y);
<a name="l00113"></a>00113                 <a class="code" href="gdatalogger_8c.html#a32674e7c2afa8b78e99a0070cf4bcaf9">gDataLogger_InsertVariable</a>(&amp;<a class="code" href="demo__pthread_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a>,<span class="stringliteral">&quot;MatB&quot;</span>,&amp;<a class="code" href="demo__pthread_8c.html#a778870de29c0389f060a5430a7a4f98a">MatB</a>[0][0]);
<a name="l00114"></a>00114         }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         printf(<span class="stringliteral">&quot;\nEncerrando a Tarefa 2.&quot;</span>);
<a name="l00117"></a>00117 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="abe3b9c2c4e21e79c7b046b5986d13acc"></a><!-- doxytag: member="demo_xenomai.c::gDataLogger" ref="abe3b9c2c4e21e79c7b046b5986d13acc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structGDATALOGGER.html">GDATALOGGER</a> <a class="el" href="demo__xenomai_8c.html#abe3b9c2c4e21e79c7b046b5986d13acc">gDataLogger</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00021">21</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3437d43ee84dba8231980614a749bb3a"></a><!-- doxytag: member="demo_xenomai.c::MatA" ref="a3437d43ee84dba8231980614a749bb3a" args="[3][1]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="demo__xenomai_8c.html#a3437d43ee84dba8231980614a749bb3a">MatA</a>[3][1]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00022">22</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

</div>
</div>
<a class="anchor" id="a778870de29c0389f060a5430a7a4f98a"></a><!-- doxytag: member="demo_xenomai.c::MatB" ref="a778870de29c0389f060a5430a7a4f98a" args="[4][2]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="demo__xenomai_8c.html#a778870de29c0389f060a5430a7a4f98a">MatB</a>[4][2]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="demo__xenomai_8c_source.html#l00023">23</a> of file <a class="el" href="demo__xenomai_8c_source.html">demo_xenomai.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Fri Jan 14 10:33:50 2011 for mmrobot-server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
